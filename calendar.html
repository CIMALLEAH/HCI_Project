<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PlanEase - Calendar</title>
  <link rel="stylesheet" href="styles.css">
  <script src="data.js"></script>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <div class="logo">
        <div class="logo-icon">ğŸ“…</div>
        <div class="logo-text">
          <h1>PLAN EASE</h1>
          <p>Plan with Ease</p>
        </div>
      </div>
      <div class="profile-icon">
        <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
          ${AppData.user.firstName.charAt(0)}
        </div>
      </div>
    </div>

    <div class="content">
      <div class="calendar-header">
        <h1>Calendar</h1>
        <div class="info-icon">â„¹ï¸</div>
      </div>

      <div class="month-nav">
        <button class="nav-btn" onclick="changeMonth(-1)">â€¹</button>
        <div class="current-month">
          <span>ğŸ“…</span>
          <span id="monthYear">October 2025</span>
        </div>
        <button class="nav-btn" onclick="changeMonth(1)">â€º</button>
      </div>

      <div class="view-toggle">
        <button class="toggle-btn active">Month</button>
        <button class="toggle-btn">Week</button>
      </div>

      <div class="calendar-grid">
        <div class="weekdays">
          <div class="weekday">Sun</div>
          <div class="weekday">Mon</div>
          <div class="weekday">Tue</div>
          <div class="weekday">Wed</div>
          <div class="weekday">Thu</div>
          <div class="weekday">Fri</div>
          <div class="weekday">Sat</div>
        </div>
        
        <div class="days" id="calendarDays"></div>
      </div>

      <div class="schedule-preview">
        <h3>ğŸ“‹ This Month's Schedule</h3>
        
        <div id="currentEvents">
          <!-- Current events will be generated dynamically -->
        </div>

        <div class="upcoming-events">
          <div class="upcoming-label">
            <span>Upcoming</span>
            <select class="sort-dropdown" onchange="sortEvents(this.value)">
              <option value="date">Sort by: Date</option>
              <option value="priority">Sort by: Priority</option>
              <option value="type">Sort by: Type</option>
            </select>
          </div>
          
          <div id="upcomingEvents">
            <!-- Upcoming events will be generated dynamically -->
          </div>
        </div>
      </div>
    </div>

    <div class="bottom-nav">
      <a href="home.html" class="nav-item">
        <div class="nav-icon">ğŸ </div>
        <div class="nav-label">Home</div>
      </a>
      <a href="calendar.html" class="nav-item active">
        <div class="nav-icon">ğŸ“…</div>
        <div class="nav-label">Calendar</div>
      </a>
      <a href="planner.html" class="nav-item">
        <div class="nav-icon">ğŸ“–</div>
        <div class="nav-label">Planner</div>
      </a>
      <a href="account.html" class="nav-item">
        <div class="nav-icon">ğŸ‘¤</div>
        <div class="nav-label">Account</div>
      </a>
    </div>
  </div>

  <script>
    let currentMonth = 9; // October (0-indexed)
    let currentYear = 2025;

    function renderCalendar() {
      const daysContainer = document.getElementById('calendarDays');
      daysContainer.innerHTML = '';
      
      const firstDay = AppData.getFirstDayOfMonth(currentYear, currentMonth);
      const daysInMonth = AppData.getDaysInMonth(currentYear, currentMonth);
      const today = new Date();
      const isCurrentMonth = today.getMonth() === currentMonth && today.getFullYear() === currentYear;
      const currentDay = today.getDate();
      
      // Empty cells before month starts
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'day';
        daysContainer.appendChild(emptyDay);
      }
      
      // Days of month
      for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'day';
        
        // Check if day is today
        if (isCurrentMonth && day === currentDay) {
          dayElement.classList.add('today');
        }
        // Check if day has events
        else if (AppData.hasEventsOnDay(currentYear, currentMonth, day)) {
          dayElement.classList.add('has-events');
        }
        
        // Check if day has conflicts
        if (AppData.isConflictDay(currentYear, currentMonth, day)) {
          dayElement.classList.remove('has-events');
          dayElement.classList.add('conflict');
        }
        
        dayElement.textContent = day;
        
        // Add indicator dots for events
        if (AppData.hasEventsOnDay(currentYear, currentMonth, day) || 
            AppData.isConflictDay(currentYear, currentMonth, day)) {
          const indicators = document.createElement('div');
          indicators.className = 'day-indicators';
          indicators.innerHTML = '<div class="indicator-dot"></div>';
          dayElement.appendChild(indicators);
        }
        
        daysContainer.appendChild(dayElement);
      }
      
      updateMonthYear();
      renderEvents();
    }

    function changeMonth(delta) {
      currentMonth += delta;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      } else if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar();
    }

    function updateMonthYear() {
      const months = ['January', 'February', 'March', 'April', 'May', 'June',
                     'July', 'August', 'September', 'October', 'November', 'December'];
      document.getElementById('monthYear').textContent = `${months[currentMonth]} ${currentYear}`;
    }

    function renderEvents() {
      renderCurrentEvents();
      renderUpcomingEvents();
    }

    function renderCurrentEvents() {
      const container = document.getElementById('currentEvents');
      const todayEvents = AppData.getTodayEvents();
      
      if (todayEvents.length === 0) {
        container.innerHTML = '';
        return;
      }
      
      let html = '';
      todayEvents.forEach(event => {
        const currentEvent = AppData.getCurrentEvent();
        const isCurrent = currentEvent && currentEvent.id === event.id;
        
        html += `
          <div class="event-item ${event.type}">
            <div class="event-header">
              <div class="event-title">
                <div class="event-indicator"></div>
                <h3>${event.title}</h3>
              </div>
              ${isCurrent ? '<div class="event-badge ending-soon">Ends in: 00:30:00</div>' : ''}
            </div>
            <div class="event-details">
              <p>ğŸ“ ${event.type.charAt(0).toUpperCase() + event.type.slice(1)}</p>
              <p>${event.fullTitle}</p>
              <p>ğŸ’» ${event.location}</p>
              <p class="event-time">Time: ${event.startTime} - ${event.endTime}</p>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    function renderUpcomingEvents() {
      const container = document.getElementById('upcomingEvents');
      const upcomingEvents = AppData.getUpcomingEvents(30).filter(e => e.daysUntil > 0);
      
      if (upcomingEvents.length === 0) {
        container.innerHTML = '<div class="no-events">No upcoming events.</div>';
        return;
      }
      
      let html = '';
      upcomingEvents.slice(0, 5).forEach(event => {
        const badgeText = event.daysUntil === 1 ? 'Tomorrow' : 
                         event.daysUntil <= 2 ? 'This Week' : 
                         `In ${event.daysUntil} days`;
        const badgeClass = event.daysUntil === 1 ? 'tomorrow' : 'friday';
        
        html += `
          <div class="event-item ${event.type}">
            <div class="event-header">
              <div class="event-title">
                <div class="event-indicator"></div>
                <h3>${event.title}</h3>
              </div>
              <div class="event-badge ${badgeClass}">${badgeText}</div>
            </div>
            <div class="event-details">
              <p>ğŸ“ ${event.type.charAt(0).toUpperCase() + event.type.slice(1)}</p>
              <p>${event.fullTitle}</p>
              <p>ğŸ’» ${event.location}</p>
              <p class="event-time">Date: ${new Date(event.date).toLocaleDateString('en-GB')}<br>Time: ${event.startTime} - ${event.endTime}</p>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    function sortEvents(sortBy) {
      // This would sort the events array in AppData based on the selected criteria
      // For now, just re-render
      renderUpcomingEvents();
    }

    // Initialize
    window.addEventListener('DOMContentLoaded', () => {
      renderCalendar();
    });
  </script>
</body>
</html>